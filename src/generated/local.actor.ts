// DO NOT EDIT.
// Generated by actr-ts-codegen.

import type { Context, RpcEnvelope } from '@actor-rtc/actr';
import { Client_AttachRequest, Client_AttachResponse, Client_PromptRequest, Client_PromptResponse } from './client.pb.js';

export const PROMPT_ROUTE_KEY = 'client.ClientService.Prompt';
export const ATTACH_ROUTE_KEY = 'client.ClientService.Attach';

((Client_PromptRequest as any).routeKey = PROMPT_ROUTE_KEY);
((Client_AttachRequest as any).routeKey = ATTACH_ROUTE_KEY);

export interface LocalHandler {
  prompt(request: Client_PromptRequest, ctx: Context): Promise<Client_PromptResponse>;
  attach(request: Client_AttachRequest, ctx: Context): Promise<Client_AttachResponse>;
}

export async function dispatch(
  handler: LocalHandler,
  ctx: Context,
  envelope: RpcEnvelope
): Promise<Buffer> {
  if (envelope.routeKey === PROMPT_ROUTE_KEY) {
    const request = Client_PromptRequest.decode(envelope.payload);
    const response = await handler.prompt(request, ctx);
    return Client_PromptResponse.encode(response);
  }

  if (envelope.routeKey === ATTACH_ROUTE_KEY) {
    const request = Client_AttachRequest.decode(envelope.payload);
    const response = await handler.attach(request, ctx);
    return Client_AttachResponse.encode(response);
  }

  throw new Error(`Unknown route: ${envelope.routeKey}`);
}